import { Injectable } from '@nestjs/common';
import { {{moduleNamePascal}} } from 'src/app/{{moduleName}}/domain/entities/{{moduleName}}.entity';
import { {{moduleNamePascal}}Status } from 'src/app/{{moduleName}}/domain/enums/{{moduleName}}-status.enum';
import { PrismaService } from 'src/infra/database/prisma/prisma.service';
import { I{{moduleNamePascal}}Repository } from '../../../application/persistence/repository/{{moduleName}}-repository.interface';

@Injectable()
export class {{moduleNamePascal}}RepositoryAdapterPrisma implements I{{moduleNamePascal}}Repository {
  constructor(private readonly prisma: PrismaService) {}

  public async save(entity: {{moduleNamePascal}}): Promise<void> {
    await this.prisma.{{moduleNameCamel}}.create({
      data: {
        id: entity.props.id,
        field: entity.props.field,
        status: entity.props.status,
        createdAt: entity.props.createdAt,
        updatedAt: entity.props.updatedAt,
      },
    });
  }

  public async edit(entity: {{moduleNamePascal}}): Promise<void> {
    await this.prisma.{{moduleNameCamel}}.update({
      where: { id: entity.props.id },
      data: {
        field: entity.props.field,
        status: entity.props.status,
        updatedAt: entity.props.updatedAt,
      },
    });
  }

  public async findById(id: string): Promise<{{moduleNamePascal}} | null> {
    const data = await this.prisma.{{moduleNameCamel}}.findUnique({
      where: { id },
    });
    if (!data) return null;
    
    return {{moduleNamePascal}}.load({
      id: data.id,
      field: data.field,
      status: data.status as {{moduleNamePascal}}Status,
      createdAt: data.createdAt,
      updatedAt: data.updatedAt,
    });
  }

  public async delete(id: string): Promise<void> {
    await this.prisma.{{moduleNameCamel}}.delete({
      where: { id },
    });
  }
}
